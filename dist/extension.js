"use strict";var $=Object.create;var B=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty;var H=(o,s)=>{for(var h in s)B(o,h,{get:s[h],enumerable:!0})},N=(o,s,h,y)=>{if(s&&typeof s=="object"||typeof s=="function")for(let S of U(s))!X.call(o,S)&&S!==h&&B(o,S,{get:()=>s[S],enumerable:!(y=O(s,S))||y.enumerable});return o};var x=(o,s,h)=>(h=o!=null?$(V(o)):{},N(s||!o||!o.__esModule?B(h,"default",{value:o,enumerable:!0}):h,o)),W=o=>N(B({},"__esModule",{value:!0}),o);var Q={};H(Q,{activate:()=>J,deactivate:()=>j});module.exports=W(Q);var e=x(require("vscode")),b=x(require("crypto")),I=x(require("path"));var R=["Node","Node3D","Node2D","AcceptDialog","AnimatableBody2D","AnimatableBody3D","AnimatedSprite2D","AnimatedSprite3D","AnimationMixer","AnimationPlayer","AnimationTree","Area2D","Area3D","AspectRatioContainer","AudioListener2D","AudioListener3D","AudioStreamPlayer","AudioStreamPlayer2D","AudioStreamPlayer3D","BackBufferCopy","BaseButton","Bone2D","BoneAttachment3D","BoxContainer","Button","Camera2D","Camera3D","CanvasGroup","CanvasItem","CanvasLayer","CanvasModulate","CenterContainer","CharacterBody2D","CharacterBody3D","CheckBox","CheckButton","CodeEdit","CollisionObject2D","CollisionObject3D","CollisionPolygon2D","CollisionPolygon3D","CollisionShape2D","CollisionShape3D","ColorPicker","ColorPickerButton","ColorRect","ConeTwistJoint3D","ConfirmationDialog","Container","Control","CPUParticles2D","CPUParticles3D","CSGBox3D","CSGCombiner3D","CSGCylinder3D","CSGMesh3D","CSGPolygon3D","CSGPrimitive3D","CSGShape3D","CSGSphere3D","CSGTorus3D","DampedSpringJoint2D","Decal","DirectionalLight2D","DirectionalLight3D","EditorCommandPalette","EditorFileDialog","EditorFileSystem","EditorInspector","EditorPlugin","EditorProperty","EditorResourcePicker","EditorResourcePreview","EditorScriptPicker","EditorSpinSlider","EditorToaster","FileDialog","FileSystemDock","FlowContainer","FogVolume","Generic6DOFJoint3D","GeometryInstance3D","GPUParticles2D","GPUParticles3D","GPUParticlesAttractor3D","GPUParticlesAttractorBox3D","GPUParticlesAttractorSphere3D","GPUParticlesAttractorVectorField3D","GPUParticlesCollision3D","GPUParticlesCollisionBox3D","GPUParticlesCollisionHeightField3D","GPUParticlesCollisionSDF3D","GPUParticlesCollisionSphere3D","GraphEdit","GraphElement","GraphFrame","GraphNode","GridContainer","GridMap","GridMapEditorPlugin","GrooveJoint2D","HBoxContainer","HFlowContainer","HingeJoint3D","HScrollBar","HSeparator","HSlider","HSplitContainer","HTTPRequest","ImporterMeshInstance3D","InstancePlaceholder","ItemList","Joint2D","Joint3D","Label","Label3D","Light2D","Light3D","LightmapGI","LightmapProbe","LightOccluder2D","Line2D","LineEdit","LinkButton","LookAtModifier3D","MarginContainer","Marker2D","Marker3D","MenuBar","MenuButton","MeshInstance2D","MeshInstance3D","MissingNode","MultiMeshInstance2D","MultiMeshInstance3D","MultiplayerSpawner","MultiplayerSynchronizer","NavigationAgent2D","NavigationAgent3D","NavigationLink2D","NavigationLink3D","NavigationObstacle2D","NavigationObstacle3D","NavigationRegion2D","NavigationRegion3D","NinePatchRect","Node2D","Node3D","OccluderInstance3D","OmniLight3D","OpenXRBindingModifierEditor","OpenXRCompositionLayer","OpenXRCompositionLayerCylinder","OpenXRCompositionLayerEquirect","OpenXRCompositionLayerQuad","OpenXRHand","OpenXRInteractionProfileEditor","OpenXRInteractionProfileEditorBase","OpenXRVisibilityMask","OptionButton","Panel","PanelContainer","Parallax2D","ParallaxBackground","ParallaxLayer","Path2D","Path3D","PathFollow2D","PathFollow3D","PhysicalBone2D","PhysicalBone3D","PhysicalBoneSimulator3D","PhysicsBody2D","PhysicsBody3D","PinJoint2D","PinJoint3D","PointLight2D","Polygon2D","Popup","PopupMenu","PopupPanel","ProgressBar","Range","RayCast2D","RayCast3D","ReferenceRect","ReflectionProbe","RemoteTransform2D","RemoteTransform3D","ResourcePreloader","RetargetModifier3D","RichTextLabel","RigidBody2D","RigidBody3D","RootMotionView","ScriptCreateDialog","ScriptEditor","ScriptEditorBase","ScrollBar","ScrollContainer","Separator","ShaderGlobalsOverride","ShapeCast2D","ShapeCast3D","Skeleton2D","Skeleton3D","SkeletonIK3D","SkeletonModifier3D","Slider","SliderJoint3D","SoftBody3D","SpinBox","SplitContainer","SpotLight3D","SpringArm3D","SpringBoneCollision3D","SpringBoneCollisionCapsule3D","SpringBoneCollisionPlane3D","SpringBoneCollisionSphere3D","SpringBoneSimulator3D","Sprite2D","Sprite3D","SpriteBase3D","StaticBody2D","StaticBody3D","StatusIndicator","SubViewport","SubViewportContainer","TabBar","TabContainer","TextEdit","TextureButton","TextureProgressBar","TextureRect","TileMap","TileMapLayer","Timer","TouchScreenButton","Tree","VBoxContainer","VehicleBody3D","VehicleWheel3D","VFlowContainer","VideoStreamPlayer","Viewport","VisibleOnScreenEnabler2D","VisibleOnScreenEnabler3D","VisibleOnScreenNotifier2D","VisibleOnScreenNotifier3D","VisualInstance3D","VoxelGI","VScrollBar","VSeparator","VSlider","VSplitContainer","Window","WorldEnvironment","XRAnchor3D","XRBodyModifier3D","XRCamera3D","XRController3D","XRFaceModifier3D","XRHandModifier3D","XRNode3D","XROrigin3D"];function J(o){let s=e.commands.registerCommand("gd-creation.createGodotFile",async w=>{let c=w.fsPath,n=await e.window.showInputBox({prompt:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F \u043D\u043E\u0432\u043E\u0433\u043E Godot-\u0444\u0430\u0439\u043B\u0430 (\u0431\u0435\u0437 .gd)",value:"NewScript",validateInput:D=>D.trim()?/[\\/:*?"<>|]/.test(D)?"\u041D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0435 \u0441\u0438\u043C\u0432\u043E\u043B\u044B \u0432 \u0438\u043C\u0435\u043D\u0438 \u0444\u0430\u0439\u043B\u0430":null:"\u0418\u043C\u044F \u0444\u0430\u0439\u043B\u0430 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C"});if(!n)return;let i=n.endsWith(".gd")?n:`${n}.gd`,t=await e.window.showQuickPick(R,{title:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0431\u0430\u0437\u043E\u0432\u044B\u0439 \u043A\u043B\u0430\u0441\u0441 (extends)",placeHolder:"Node3D"})||"Node3D",l=I.join(c,i),a=`${l}.uid`,p=e.Uri.file(l),g=e.Uri.file(a),d=M();try{let D=`extends ${t}
`;await e.workspace.fs.writeFile(p,new TextEncoder().encode(D));let r=`uid://${d}`;await e.workspace.fs.writeFile(g,new TextEncoder().encode(r)),e.window.showInformationMessage(`\u0421\u043E\u0437\u0434\u0430\u043D\u043E: ${i} \u0441 extends ${t}`)}catch(D){e.window.showErrorMessage(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u0444\u0430\u0439\u043B\u043E\u0432: ${D}`)}});o.subscriptions.push(s);let h=e.commands.registerCommand("gd-creation.attachScriptToScene",async w=>{let c=await e.workspace.findFiles("**/*.gd","**/node_modules/**",200);if(c.length===0){e.window.showWarningMessage("\u0421\u043A\u0440\u0438\u043F\u0442\u044B .gd \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B");return}let n=await e.window.showQuickPick(c.map(u=>({label:e.workspace.asRelativePath(u),description:u.fsPath,uri:u})),{title:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043A\u0440\u0438\u043F\u0442 \u0434\u043B\u044F \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u043B\u0435\u043D\u0438\u044F"});if(!n)return;let i=await e.workspace.openTextDocument(w),m=i.getText(),t=m.split(`
`),l=[],a=null,p=!1;for(let u=0;u<t.length;u++){let G=t[u],L=G.match(/^\[node name=\"([^\"]+)\"/);if(L){a&&!p&&l.push(a),a=L[1],p=!1;continue}a&&G.includes("script = ExtResource")&&(p=!0)}if(a&&!p&&l.push(a),l.length===0){e.window.showWarningMessage("\u041D\u0435\u0442 \u0443\u0437\u043B\u043E\u0432 \u0431\u0435\u0437 \u043F\u0440\u0438\u0432\u044F\u0437\u0430\u043D\u043D\u044B\u0445 \u0441\u043A\u0440\u0438\u043F\u0442\u043E\u0432.");return}let g=await e.window.showQuickPick(l,{title:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0443\u0437\u0435\u043B, \u043A \u043A\u043E\u0442\u043E\u0440\u043E\u043C\u0443 \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0441\u043A\u0440\u0438\u043F\u0442"});if(!g)return;let d=e.workspace.asRelativePath(n.uri).replace(/\\/g,"/"),D=M(),r=`1_${D.slice(0,5)}`,f=`[ext_resource type="Script" uid="uid://${D}" path="res://${d}" id="${r}"]`,C=`script = ExtResource("${r}")`;if(m.includes(`path="res://${d}"`)){e.window.showWarningMessage("\u042D\u0442\u043E\u0442 \u0441\u043A\u0440\u0438\u043F\u0442 \u0443\u0436\u0435 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0451\u043D.");return}let v=t.findIndex(u=>u.startsWith("[ext_resource"))+1||1;t.splice(v,0,f);let A=`[node name="${g}"`,k=t.findIndex(u=>u.trim().startsWith(A));if(k===-1){e.window.showErrorMessage(`\u0423\u0437\u0435\u043B \u0441 \u0438\u043C\u0435\u043D\u0435\u043C "${g}" \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D \u0432 \u0441\u0446\u0435\u043D\u0435.`);return}let P=k+1;for(;P<t.length&&!t[P].startsWith("[");)P++;t[P-1].trim()!==""?t.splice(P,0,C):t[P-1]=C;let T=t.join(`
`),E=new e.WorkspaceEdit,F=new e.Range(i.positionAt(0),i.positionAt(m.length));E.replace(w,F,T),await e.workspace.applyEdit(E),await i.save(),e.window.showInformationMessage(`\u0421\u043A\u0440\u0438\u043F\u0442 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u043B\u0451\u043D \u043A \u0443\u0437\u043B\u0443 "${g}".`)});o.subscriptions.push(h);let y=e.commands.registerCommand("gd-creation.createGodotScene",async w=>{let c=w.fsPath,n=await e.window.showInputBox({prompt:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F \u043D\u043E\u0432\u043E\u0439 \u0441\u0446\u0435\u043D\u044B (\u0431\u0435\u0437 .tscn)",value:"NewScene",validateInput:d=>d.trim()?/[\\/:*?"<>|]/.test(d)?"\u041D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0435 \u0441\u0438\u043C\u0432\u043E\u043B\u044B \u0432 \u0438\u043C\u0435\u043D\u0438 \u0441\u0446\u0435\u043D\u044B":null:"\u0418\u043C\u044F \u0441\u0446\u0435\u043D\u044B \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0443\u0441\u0442\u044B\u043C"});if(!n)return;let i=n.endsWith(".tscn")?n:`${n}.tscn`,t=await e.window.showQuickPick(R,{title:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0438\u043F \u043A\u043E\u0440\u043D\u0435\u0432\u043E\u0433\u043E \u0443\u0437\u043B\u0430",placeHolder:"Node3D"})||"Node3D",a=`[gd_scene format=3 uid="uid://${M()}"]

[node name="${n}" type="${t}"]
`,p=I.join(c,i),g=e.Uri.file(p);try{await e.workspace.fs.writeFile(g,new TextEncoder().encode(a)),e.window.showInformationMessage(`\u0421\u0446\u0435\u043D\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0430: ${i} \u0441 \u043A\u043E\u0440\u043D\u0435\u0432\u044B\u043C \u0443\u0437\u043B\u043E\u043C ${t}`)}catch(d){e.window.showErrorMessage(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u0438 \u0441\u0446\u0435\u043D\u044B: ${d}`)}}),S=e.commands.registerCommand("gd-creation.detachScriptFromScene",async w=>{try{let c=await e.workspace.openTextDocument(w),n=c.getText(),i=n.split(`
`),m=[],t="";for(let r=0;r<i.length;r++){let f=i[r],C=f.match(/^\[node name=\"([^\"]+)\"/);C&&(t=C[1]);let v=f.match(/script = ExtResource\(\"([^\"]+)\"\)/);v&&t&&m.push({nodeName:t,scriptLineIndex:r,extResourceId:v[1]})}if(m.length===0){e.window.showInformationMessage("\u0421\u043A\u0440\u0438\u043F\u0442\u044B \u0434\u043B\u044F \u043E\u0442\u043A\u0440\u0435\u043F\u043B\u0435\u043D\u0438\u044F \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B.");return}let l=await e.window.showQuickPick(m.map(r=>({label:r.nodeName,description:r.extResourceId})),{title:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0443\u0437\u0435\u043B \u0434\u043B\u044F \u043E\u0442\u043A\u0440\u0435\u043F\u043B\u0435\u043D\u0438\u044F \u0441\u043A\u0440\u0438\u043F\u0442\u0430"});if(!l)return;let a=m.find(r=>r.nodeName===l.label);if(!a)return;i.splice(a.scriptLineIndex,1);let p=i.findIndex(r=>r.includes(`id="${a.extResourceId}"`));p!==-1&&i.splice(p,1);let g=i.join(`
`),d=new e.WorkspaceEdit,D=new e.Range(c.positionAt(0),c.positionAt(n.length));d.replace(w,D,g),await e.workspace.applyEdit(d),await c.save(),e.window.showInformationMessage(`\u0421\u043A\u0440\u0438\u043F\u0442 \u043E\u0442\u043A\u0440\u0435\u043F\u043B\u0451\u043D \u043E\u0442 \u0443\u0437\u043B\u0430 "${a.nodeName}".`)}catch(c){e.window.showErrorMessage(`\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043A\u0440\u0435\u043F\u043B\u0435\u043D\u0438\u0438 \u0441\u043A\u0440\u0438\u043F\u0442\u0430: ${c}`)}});o.subscriptions.push(S)}function j(){}function M(){return b.randomBytes(9).toString("base64url")}0&&(module.exports={activate,deactivate});
